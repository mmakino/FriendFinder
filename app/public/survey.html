<!DOCTYPE html>

<!-- 
  This HTML file has been started off from the sample html file 
  of the instrution and modified the dropdown menu as radio buttons, 
  updated the validation, and so on.
  The model source at https://friend-finder-fsf.herokuapp.com
-->
  
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Friend Finder</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/style_survey.css">

  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</head>

<body>
  <div class="container">
    <h2>Survey Questions</h2>
    <hr>

    <h3><strong>About You</strong></h3>
    <h4>Name (Required)</h4>
    <input type="text" id="name" class="form-control" required>

    <h4>Link to Photo Image (Required)</h4>
    <input type="text" id="photo" class="form-control" required>

    <hr>

    <form>
      <ol>
        <li>
          <h4>I dislike myself</h4>
          <input type="radio" name="1" value="1" id="radio-1" class="form-radio">
          <label for="radio-1">1)Strongly Disagree</label>
          <input type="radio" name="1" value="2" id="radio-2" class="form-radio">
          <label for="radio-2">2)Disagree </label>
          <input type="radio" name="1" value="3" id="radio-3" class="form-radio">
          <label for="radio-3">3)Neutral </label>
          <input type="radio" name="1" value="4" id="radio-4" class="form-radio">
          <label for="radio-4">4)Agree </label>
          <input type="radio" name="1" value="5" id="radio-5" class="form-radio">
          <label for="radio-5">5)Strongly Agree</label>
        </li>
        <li>
          <h4>I tell the truth</h4>
          <input type="radio" name="2" value="1" id="radio-1" class="form-radio">
          <label for="radio-1">1)Strongly Disagree</label>
          <input type="radio" name="2" value="2" id="radio-2" class="form-radio">
          <label for="radio-2">2)Disagree </label>
          <input type="radio" name="2" value="3" id="radio-3" class="form-radio">
          <label for="radio-3">3)Neutral </label>
          <input type="radio" name="2" value="4" id="radio-4" class="form-radio">
          <label for="radio-4">4)Agree </label>
          <input type="radio" name="2" value="5" id="radio-5" class="form-radio">
          <label for="radio-5">5)Strongly Agree</label>
        </li>
        <li>
          <h4>I trust others</h4>
          <input type="radio" name="3" value="1" id="radio-1" class="form-radio">
          <label for="radio-1">1)Strongly Disagree</label>
          <input type="radio" name="3" value="2" id="radio-2" class="form-radio">
          <label for="radio-2">2)Disagree </label>
          <input type="radio" name="3" value="3" id="radio-3" class="form-radio">
          <label for="radio-3">3)Neutral </label>
          <input type="radio" name="3" value="4" id="radio-4" class="form-radio">
          <label for="radio-4">4)Agree </label>
          <input type="radio" name="3" value="5" id="radio-5" class="form-radio">
          <label for="radio-5">5)Strongly Agree</label>
        </li>
        <li>
          <h4>I get angry easily</h4>
          <input type="radio" name="4" value="1" id="radio-1" class="form-radio">
          <label for="radio-1">1)Strongly Disagree</label>
          <input type="radio" name="4" value="2" id="radio-2" class="form-radio">
          <label for="radio-2">2)Disagree </label>
          <input type="radio" name="4" value="3" id="radio-3" class="form-radio">
          <label for="radio-3">3)Neutral </label>
          <input type="radio" name="4" value="4" id="radio-4" class="form-radio">
          <label for="radio-4">4)Agree </label>
          <input type="radio" name="4" value="5" id="radio-5" class="form-radio">
          <label for="radio-5">5)Strongly Agree</label>
        </li>
        <li>
          <h4>I think art is important</h4>
          <input type="radio" name="5" value="1" id="radio-1" class="form-radio">
          <label for="radio-1">1)Strongly Disagree</label>
          <input type="radio" name="5" value="2" id="radio-2" class="form-radio">
          <label for="radio-2">2)Disagree </label>
          <input type="radio" name="5" value="3" id="radio-3" class="form-radio">
          <label for="radio-3">3)Neutral </label>
          <input type="radio" name="5" value="4" id="radio-4" class="form-radio">
          <label for="radio-4">4)Agree </label>
          <input type="radio" name="5" value="5" id="radio-5" class="form-radio">
          <label for="radio-5">5)Strongly Agree</label>
        </li>
        <li>
          <h4>I love to help others</h4>
          <input type="radio" name="6" value="1" id="radio-1" class="form-radio">
          <label for="radio-1">1)Strongly Disagree</label>
          <input type="radio" name="6" value="2" id="radio-2" class="form-radio">
          <label for="radio-2">2)Disagree </label>
          <input type="radio" name="6" value="3" id="radio-3" class="form-radio">
          <label for="radio-3">3)Neutral </label>
          <input type="radio" name="6" value="4" id="radio-4" class="form-radio">
          <label for="radio-4">4)Agree </label>
          <input type="radio" name="6" value="5" id="radio-5" class="form-radio">
          <label for="radio-5">5)Strongly Agree</label>
        </li>
        <li>
          <h4>I keep my promises</h4>
          <input type="radio" name="7" value="1" id="radio-1" class="form-radio">
          <label for="radio-1">1)Strongly Disagree</label>
          <input type="radio" name="7" value="2" id="radio-2" class="form-radio">
          <label for="radio-2">2)Disagree </label>
          <input type="radio" name="7" value="3" id="radio-3" class="form-radio">
          <label for="radio-3">3)Neutral </label>
          <input type="radio" name="7" value="4" id="radio-4" class="form-radio">
          <label for="radio-4">4)Agree </label>
          <input type="radio" name="7" value="5" id="radio-5" class="form-radio">
          <label for="radio-5">5)Strongly Agree</label>
        </li>
        <li>
          <h4>I prefer variety to routine</h4>
          <input type="radio" name="8" value="1" id="radio-1" class="form-radio">
          <label for="radio-1">1)Strongly Disagree</label>
          <input type="radio" name="8" value="2" id="radio-2" class="form-radio">
          <label for="radio-2">2)Disagree </label>
          <input type="radio" name="8" value="3" id="radio-3" class="form-radio">
          <label for="radio-3">3)Neutral </label>
          <input type="radio" name="8" value="4" id="radio-4" class="form-radio">
          <label for="radio-4">4)Agree </label>
          <input type="radio" name="8" value="5" id="radio-5" class="form-radio">
          <label for="radio-5">5)Strongly Agree</label>
        </li>
        <li>
          <h4>I shout and yell at people</h4>
          <input type="radio" name="9" value="1" id="radio-1" class="form-radio">
          <label for="radio-1">1)Strongly Disagree</label>
          <input type="radio" name="9" value="2" id="radio-2" class="form-radio">
          <label for="radio-2">2)Disagree </label>
          <input type="radio" name="9" value="3" id="radio-3" class="form-radio">
          <label for="radio-3">3)Neutral </label>
          <input type="radio" name="9" value="4" id="radio-4" class="form-radio">
          <label for="radio-4">4)Agree </label>
          <input type="radio" name="9" value="5" id="radio-5" class="form-radio">
          <label for="radio-5">5)Strongly Agree</label>
        </li>
        <li>
          <h4>I make friends easily</h4>
          <input type="radio" name="10" value="1" id="radio-1" class="form-radio">
          <label for="radio-1">1)Strongly Disagree</label>
          <input type="radio" name="10" value="2" id="radio-2" class="form-radio">
          <label for="radio-2">2)Disagree </label>
          <input type="radio" name="10" value="3" id="radio-3" class="form-radio">
          <label for="radio-3">3)Neutral </label>
          <input type="radio" name="10" value="4" id="radio-4" class="form-radio">
          <label for="radio-4">4)Agree </label>
          <input type="radio" name="10" value="5" id="radio-5" class="form-radio">
          <label for="radio-5">5)Strongly Agree</label>
        </li>
      </ol>
    </form>
    <br>
    <br>

    <!-- Submit Button -->
    <button type="submit" class="btn btn-primary btn-lg btn-block" id="submit">
      <i class="fa fa-check-circle" aria-hidden="true"></i>
      Submit
    </button>

    <hr>
    <footer class="footer">
      <div class="container">
        <p><a href="/">Home</a> | <a href="/api/friends">API Friends List</a> | <a href="https://github.com/mmakino/FriendFinder">GitHub Repo</a></p>
      </div>
    </footer>

  </div>

  <!-- Modal dialog for the result match-->
  <div id="results-modal" class="modal fade" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title"><strong>Best Match</strong></h2>
        </div>
        <div class="modal-body">
          <h2 id="match-name"></h2>
          <img id="match-img" src="" alt="No image available" class="img-fluid rounded mx-auto">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>

    </div>
  </div>

  <script type="text/javascript">
    // catch the form inputs
    $("#submit").on("click", function (event) {
      event.preventDefault();
      console.log('Submitting the form');

      // Form validation
      let questions = {};
      function validateForm() {
        
        $("form input:radio").each(function () {
          // console.log($(this).attr("name"), $(this).val(), $(this).prop('checked'));
          if (!($(this).attr("name") in questions)) {
            questions[$(this).attr("name")] = false;
          }
          if ($(this).prop("checked")) {
            questions[$(this).attr("name")] = parseInt($(this).val());
          }
        });
        console.log(questions);
        
        let isValid = Object.values(questions).every(v => v !== false);
        isValid = $('#name').val() !== "";
        isValid = $('#photo').val() !== "";
        
        return isValid;
      }

      // If all required fields are filled
      if (validateForm()) {
        // Create an object for the user"s data
        let userData = {
          name: $("#name").val(),
          photo: $("#photo").val(),
          scores: Object.values(questions) 
        };

        // AJAX post the data to the friends API.
        $.post("/api/friends", userData, function (data) {

          // Grab the result from the AJAX post so that the best match's name and photo are displayed.
          $("#match-name").text(data.name);
          $("#match-img").attr("src", data.photo);

          // Show the modal with the best match
          $("#results-modal").modal("toggle");

        });
      } else {
        let missing = Object.entries(questions).filter(v => v === false);
        alert("Please fill out all fields before submitting!");
      }
    });
  </script>

</body>

</html>